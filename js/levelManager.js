// js/levelManager.js

class LevelManager {
    constructor(game) {
        this.game = game;
        this.currentLevelIndex = -1;
        this.levels = [
            // LEVEL 1: First Encounter
            {
                mapGrid: [
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0],[1,1,0,1,0,1,1,1,0,2,2,0,1,1,1,0,1,0,1,1],[0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0],[0,0,1,1,0,1,1,0,0,0,0,0,0,1,1,0,1,1,0,0],[0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,0,0,0,0],[0,0,1,1,0,1,1,0,0,0,0,0,0,1,1,0,1,1,0,0],[0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0],[1,1,0,1,0,1,1,1,0,2,2,0,1,1,1,0,1,0,1,1],[0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0],[0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                ],
                enemySpawnPoints: [ { x: 50, y: 50 }, { x: 700, y: 50 } ],
                playerSpawnPoint: { x: 380, y: 550 },
                enemyMaxCount: 2
            },
            // LEVEL 2: The Crossroads
            {
                mapGrid: [
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0],[1,1,1,0,1,0,0,0,0,1,1,0,0,0,0,1,0,1,1,1],[0,0,1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1,0,0],[0,0,1,0,0,0,1,2,0,0,0,0,2,1,0,0,0,1,0,0],[0,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,0],[0,0,1,0,1,0,0,0,0,2,2,0,0,0,0,1,0,1,0,0],[0,0,1,0,1,0,1,1,1,1,1,1,1,1,0,1,0,1,0,0],[0,0,1,0,0,0,1,2,0,0,0,0,2,1,0,0,0,1,0,0],[0,0,1,0,1,0,1,1,0,1,1,0,1,1,0,1,0,1,0,0],[1,1,1,0,1,0,0,0,0,1,1,0,0,0,0,1,0,1,1,1],[0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                ],
                enemySpawnPoints: [ { x: 50, y: 50 }, { x: 700, y: 50 }, { x: 380, y: 50 } ],
                playerSpawnPoint: { x: 380, y: 550 },
                enemyMaxCount: 3
            },
            // LEVEL 3: The Gauntlet
            {
                mapGrid: [
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,2,1,1,1,1,2,1,1,0,0,0,0,0],[1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1],[2,2,0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,2,2],[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0],[2,2,0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,2,2],[1,1,1,1,0,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1],[0,0,0,0,0,1,1,2,1,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
                ],
                enemySpawnPoints: [ { x: 50, y: 50 }, { x: 700, y: 50 }, { x: 50, y: 300 }, { x: 700, y: 300 } ],
                playerSpawnPoint: { x: 380, y: 550 },
                enemyMaxCount: 4
            }
        ];
        this.maxLevel = this.levels.length;
    }

    loadLevelData(levelIndex) {
        if (levelIndex >= this.maxLevel || levelIndex < 0) {
            console.error(`Invalid level index: ${levelIndex}`);
            return null;
        }
        this.currentLevelIndex = levelIndex;
        return this.levels[this.currentLevelIndex];
    }

    nextLevel() {
        const nextIndex = this.currentLevelIndex + 1;
        if (nextIndex >= this.maxLevel) {
            this.game.enterVictoryState();
        } else {
            const levelData = this.loadLevelData(nextIndex);
            if (levelData) this.game.loadLevel(levelData);
        }
    }

    reset() {
        const levelData = this.loadLevelData(0);
        if (levelData) this.game.loadLevel(levelData);
    }
}